# Анимации сцены

## Оригинальная логика (ScummVM / Kyrandia LoK)

В оригинале анимации комнаты описаны в файлах сцены `.DAT`:
- `spriteDefs` задают прямоугольники внутри фонового изображения. Эти прямоугольники и есть кадры (например огонь лампы).
- `anims` — это небольшие скрипты с опкодами (`FF88`, `FF8A`, `FF8B` и т.д.), которые меняют кадр и задают задержки.
- Отрисовка идёт поверх фона, до персонажей.

Источник в ScummVM: `engines/kyra/engine/sprites.cpp`.

## Реализация в этом проекте

Мы конвертируем `.DAT` в JSON и выполняем те же скрипты в рантайме:

- JSON сцены: `public/assets/scenes/dat/<SCENE>.json`
- Конвертер: `extractor/dat_to_json.py` и пакетный `extractor/dat_batch_to_json.py`
- Рантайм: `src/engine/game.ts` (обновление и отрисовка scene anims)

Поддерживаемые опкоды:
- `FF88` / `FF8D` — выбрать кадр и позицию (обычный / отзеркаленный)
- `FF8A` — задержка (в тиках)
- `FF8B` — переход в начало скрипта
- `FF90` / `FF91` — выбрать кадр по default X/Y (обычный / отзеркаленный)
- `FF92..FF95` — изменить default X/Y
- `FF96` — остановить другую анимацию
- `FFA7` — запустить другую анимацию

Длина тика: `1000 / 60` мс (скорость DOS), совпадает с логикой ScummVM для LoK.

## Перегенерация JSON

```
python extractor/dat_batch_to_json.py d:\GitHub\vuekyr\extracted_files\dat_pak d:\GitHub\vuekyr\public\assets\scenes\dat
```
